#{extends 'main.html' /} 
#{set title:'TreeMarks' /} 

<div>
<strong>TreeMarks:</strong><br/>

<div id="treemarks"></div>
 
<strong>Groups:</strong><br/>

<div id="subgroups"></div>

<a id="addResource" href="#">Add TreeMark</a>

<a id="addGroup" href="#">Add Group</a>

<a id="loadGroup" href="#">Load Group</a>

<script type="text/javascript" charset="utf-8">	
<!--
var currentGroup = ${rootGroup.id.toInteger()};

$('#addResource').click(function() {
	$.post('@{addResource()}', {groupId: currentGroup, url: prompt('URL:')}, function(resource) {
		$('#resources').append(
			'<li><a href="'+ resource.url + '">' + resource.title + '</a></li>'
		)
	})
});

$('#addGroup').click(function() {
	$.post('@{addGroup()}', {parentGroupId: currentGroup, name: prompt('Name:')}, function(group) {
		$('#groups').prepend(
			'<li><a href="groups/'+ parseInt(group.id) + '">' + group.name + '</a></li>'
		)
	})
});

$('#loadGroup').click(function() { $.loadGroup() });

$.loadGroup = function() {
	$.post('@{listSubGroups()}', {groupId: currentGroup}, function(subgroups) {
		$('#subgroups').empty();
		$.each(subgroups, function(index, subgroup) {
			$('#subgroups').append(
					'<div><a href="javascript:$.openGroup('+subgroup.id+')">' + subgroup.name + '</a></div>'
			)
		})
	})
	$.post('@{listResources()}', {groupId: currentGroup}, function(resources) {
		$('#treemarks').empty();
		$.each(resources, function(index, resource) {
			$('#treemarks').append(
					'<div><a href="javascript:$.openResource('+resource.id+')">' + resource.title + '</a></div>'
			)
		})
	})
}

$.openGroup = function (groupId) {
	currentGroup = groupId;
	$.loadGroup()
}

$(document).ready(function() {
	 $.loadGroup();
});

</script>
</div>
